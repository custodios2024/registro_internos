<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Internos</title>
    <style>
        /* Tu estilo aquí */
    </style>
    <!-- Importar jsPDF y jsPDF-Autotable desde CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <!-- Contenedor de login -->
    <div id="loginContainer">
        <h2>Inicio de sesión</h2>
        <label for="username">Usuario:</label>
        <input type="text" id="username">
        <label for="password">Contraseña:</label>
        <input type="password" id="password">
        <button onclick="login()">Iniciar sesión</button>
    </div>

    <!-- Contenedor de registro -->
    <div id="registroContainer" style="display:none;">
        <h2>Registro de Internos</h2>
        <form id="registroForm">
            <!-- Agregar campo Centro de Internamiento -->
            <label for="centro">Centro de Internamiento:</label>
            <input type="text" id="centro" name="centro" value="DIRECCION DE MEDIDAS DE EJECUCION PARA ADOLESCENTES">
            
            <!-- Otros campos del formulario -->
            <label for="fecha">Fecha:</label>
            <input type="date" id="fecha" name="fecha" required>
            
            <label for="hora">Hora:</label>
            <input type="time" id="hora" name="hora" required>
            
            <label for="motivo">Motivo:</label>
            <input type="text" id="motivo" name="motivo" required>
            
            <label for="excarcelados">Excarcelados:</label>
            <input type="number" id="excarcelados" name="excarcelados" required>
            
            <label for="presentes">Presentes:</label>
            <input type="number" id="presentes" name="presentes" required>
            
            <label for="total">Total:</label>
            <input type="number" id="total" name="total" required>
            
            <label for="custodioResponsable">Custodio Responsable:</label>
            <input type="text" id="custodioResponsable" name="custodioResponsable" required>
            
            <label for="personalDGRS">Personal D.G.R.S.:</label>
            <input type="text" id="personalDGRS" name="personalDGRS" required>

            <button type="button" class="btn" onclick="guardarRegistro()">Guardar</button>
            <button type="button" class="btn" onclick="exportarPDF()">Guardar PDF del día</button>
            <button type="button" class="btn" onclick="exportarPDFCompleto()">Guardar PDF completo</button>
            <button type="button" class="btn" onclick="cerrarSesion()">Cerrar sesión</button>
        </form>
        
        <!-- Elementos adicionales para mostrar registros -->
        <select id="fechaSeleccion" onchange="mostrarRegistrosPorFecha()"></select>
        <div class="record-list" id="recordList"></div>
    </div>

    <script>
        // Función para guardar el registro
        function guardarRegistro() {
            const registro = {
                centro: document.getElementById('centro').value,
                fecha: document.getElementById('fecha').value,
                hora: document.getElementById('hora').value,
                motivo: document.getElementById('motivo').value,
                excarcelados: document.getElementById('excarcelados').value,
                presentes: document.getElementById('presentes').value,
                total: document.getElementById('total').value,
                custodioResponsable: document.getElementById('custodioResponsable').value,
                personalDGRS: document.getElementById('personalDGRS').value
            };

            // Guardar en localStorage
            const registroID = `registro_${registro.fecha}_${registro.hora}`;
            localStorage.setItem(registroID, JSON.stringify(registro));
            alert('Registro guardado exitosamente');
        }

        // Función para exportar registros del día a PDF
        function exportarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            const fechaSeleccionada = document.getElementById('fecha').value;
            const registros = [];

            for (let i = 0; i < localStorage.length; i++) {
                let key = localStorage.key(i);
                if (key.startsWith('registro_') && key.includes(fechaSeleccionada)) {
                    registros.push(JSON.parse(localStorage.getItem(key)));
                }
            }

            if (registros.length === 0) {
                alert('No hay registros para esta fecha.');
                return;
            }

            // Encabezado centrado
            const centroInternamiento = document.getElementById('centro').value;
            doc.setFontSize(16);
            doc.text("Registro de Internos", doc.internal.pageSize.getWidth() / 2, 15, { align: "center" });
            doc.setFontSize(12);
            doc.text(`Centro de Internamiento: ${centroInternamiento}`, doc.internal.pageSize.getWidth() / 2, 22, { align: "center" });

            const columns = ["Centro", "Fecha", "Hora", "Motivo", "Excarcelados", "Presentes", "Total", "Custodio Responsable", "Personal DGRS"];
            const rows = registros.map(registro => [
                registro.centro,
                registro.fecha,
                registro.hora,
                registro.motivo,
                registro.excarcelados,
                registro.presentes,
                registro.total,
                registro.custodioResponsable,
                registro.personalDGRS
            ]);

            doc.autoTable({
                head: [columns],
                body: rows,
                startY: 30,  // Ajustar para dejar espacio para el encabezado
                theme: 'grid'
            });

            doc.save(`Registro_${fechaSeleccionada}.pdf`);
        }

        // Función para exportar todos los registros a PDF
        function exportarPDFCompleto() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            const registros = [];

            for (let i = 0; i < localStorage.length; i++) {
                let key = localStorage.key(i);
                if (key.startsWith('registro_')) {
                    registros.push(JSON.parse(localStorage.getItem(key)));
                }
            }

            if (registros.length === 0) {
                alert('No hay registros para exportar.');
                return;
            }

            // Encabezado centrado
            const centroInternamiento = document.getElementById('centro').value;
            doc.setFontSize(16);
            doc.text("Registro de Internos", doc.internal.pageSize.getWidth() / 2, 15, { align: "center" });
            doc.setFontSize(12);
            doc.text(`Centro de Internamiento: ${centroInternamiento}`, doc.internal.pageSize.getWidth() / 2, 22, { align: "center" });

            const columns = ["Centro", "Fecha", "Hora", "Motivo", "Excarcelados", "Presentes", "Total", "Custodio Responsable", "Personal DGRS"];
            const rows = registros.map(registro => [
                registro.centro,
                registro.fecha,
                registro.hora,
                registro.motivo,
                registro.excarcelados,
                registro.presentes,
                registro.total,
                registro.custodioResponsable,
                registro.personalDGRS
            ]);

            doc.autoTable({
                head: [columns],
                body: rows,
                startY: 30,  // Ajustar para dejar espacio para el encabezado
                theme: 'grid'
            });

            doc.save('Registro_Completo.pdf');
        }

        // Función para mostrar registros por fecha
        function mostrarRegistrosPorFecha() {
            const fechaSeleccionada = document.getElementById('fechaSeleccion').value;
            const recordList = document.getElementById('recordList');
            recordList.innerHTML = ''; // Limpiar la lista antes de mostrar los nuevos registros

            for (let i = 0; i < localStorage.length; i++) {
                let key = localStorage.key(i);
                if (key.startsWith('registro_') && key.includes(fechaSeleccionada)) {
                    const registro = JSON.parse(localStorage.getItem(key));
                    const registroElement = document.createElement('div');
                    registroElement.textContent = `Centro: ${registro.centro}, Fecha: ${registro.fecha}, Hora: ${registro.hora}, Motivo: ${registro.motivo}, Excarcelados: ${registro.excarcelados}, Presentes: ${registro.presentes}, Total: ${registro.total}, Custodio Responsable: ${registro.custodioResponsable}, Personal DGRS: ${registro.personalDGRS}`;
                    recordList.appendChild(registroElement);
                }
            }
        }

        // Funciones de login y manejo de sesión
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === 'usuario' && password === 'contraseña') {
                alert('Inicio de sesión exitoso');
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('registroContainer').style.display = 'block';
                localStorage.setItem('sessionActive', 'true');
            } else {
                alert('Usuario o contraseña incorrectos');
            }
        }

        function cerrarSesion() {
            localStorage.removeItem('sessionActive');
            location.reload();
        }

        function verificarSesion() {
            if (localStorage.getItem('sessionActive') === 'true') {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('registroContainer').style.display = 'block';
            }
        }

        window.onload = verificarSesion;
    </script>
</body>
</html>
